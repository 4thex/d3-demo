<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />
    <link rel="icon" href="d3.svg" />
    <title>D3 Demo</title>
    <script src="node_modules/d3/dist/d3.min.js" charset="utf-8"></script>

		<link rel="stylesheet" href="node_modules/reveal.js/dist/reset.css">
		<link rel="stylesheet" href="node_modules/reveal.js/dist/reveal.css">
		<link rel="stylesheet" href="node_modules/reveal.js/dist/theme/league.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="node_modules/reveal.js/plugin/highlight/monokai.css" id="highlight-theme">
    <script src="node_modules/reveal.js/plugin/highlight/highlight.js"></script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          Data Visualization with D3
        </section>
        <section>
          <section>
            Hello World
          </section>
          <section class="x-demo" src="a-hello">
          </section>
          <section class="x-code" src="a-hello/main.js">
          </section>
        </section>
        <section>
          <section>
            Binding
          </section>
          <section class="x-demo" src="b-binding" />
          </section>
          <section class="x-code" src="b-binding/main.js">
          </section>
        </section>
        <section>
          <section>
            Bars
          </section>
          <section class="x-demo" src="c-bars">
          </section>
          <section class="x-code" src="c-bars/main.js">
          </section>
        </section>
      </div>
    </div>
    <script src="node_modules/reveal.js/dist/reveal.js"></script>
    <script>
      Reveal.initialize({
        plugins: [ RevealHighlight ],
        center: false
      });
      let hljs = Reveal.getPlugin("highlight").hljs;
      Reveal.on("slidechanged", event => {
        // let id = event.currentSlide.id;
        // if(!id) return;
        // let slide = d3.select(`#${id}`);
        let slide = d3.select(event.currentSlide);
        let src = slide.attr("src");
        if(!src) return;
        if(slide.classed("x-demo")) {
          if(slide.select("iframe").empty()) {
            slide
              .append("iframe")
              .attr("src", src);
          }
          return;
        }
        if(slide.classed("x-code")) {
          let code = d3.text(src)
            .then(text => {
              if(slide.select("pre").empty()) {
                let block = slide
                .append("pre")
                .append("code")
                .html(`${text}`).node();
                // Rerender
                hljs.highlightBlock(block);
                hljs.lineNumbersBlock(block);
              }
            });
          return;
        }
      });
    </script>
    <script type="text/javascript">
      let fetchCode = () => {
        console.log("Fetching the code");
      };
    </script>
  </body>
</html>
